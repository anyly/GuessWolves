<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, user-scalable=no"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>狼人一夜</title>
    <script src="js/jquery-3.3.1.min.js"></script>
    <!--<script src="js/jquery.mobile-1.4.5.min.js"></script>-->
    <script src="js/websocket-client.js"></script>
    <script src="js/util.js"></script>
    <link rel="stylesheet" href="css/base.css" type="text/css"/>
<style>
body{
    background-color: white;
}
page {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    overflow: hidden;
}
game {
    flex:1 0 0;
    max-width :560px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    overflow-y: auto;
}
hr {
    width: 100%;
    border: none;
    border-bottom: 1px #ccc solid;
}
discard {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: row;
}
discard>column {

}
poker {
    background: url('img/discard.jpg') no-repeat;
    background-size: contain;
    background-position: center;
    width: 45px;
    height: 67px;
    border: 1px #ccc solid;
    margin: 3px;

    color: white;
    line-height: 23px;
    text-indent: 10px;
}
seat {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-direction: row;
    flex-wrap: wrap;
}
player {
    display: flex;
    flex-direction: row;
    /*flex-wrap: wrap;*/
    justify-content: center;
    align-items: stretch;

    color: darkblue;
    font-weight: bold;

}
portrait {
    display: block;
    width: 45px;
    height: 45px;
    color: #222;;
    font-weight: bold;
    margin: 3px 0;
    border: 1px #ccc solid;
    background-image: url("img/img0.jpg");
    background-size: contain;
    background-position: center;
    position: relative;
}
no {
    z-index: 200;
    position: absolute;
    left: 2px;
    top:0;
    color: darkblue;
}
player[seat='1'] no:before {
    content: '1';
}
player[seat='2'] no:before {
    content: '2';
}
player[seat='3'] no:before {
    content: '3';
}
player[seat='4'] no:before {
    content: '4';
}
player[seat='5'] no:before {
    content: '5';
}
player[seat='6'] no:before {
    content: '6';
}
player[seat='7'] no:before {
    content: '7';
}
player[seat='8'] no:before {
    content: '8';
}
player[seat='9'] no:before {
    content: '9';
}
player[seat='10'] no:before {
    content: '10';
}
player[seat='11'] no:before {
    content: '11';
}
player[seat='12'] no:before {
    content: '12';
}
player[seat='13'] no:before {
    content: '13';
}
ready {
    position: absolute;
    left: 0;
    top:0;
    right: 0;
    bottom: 0;

    /*display: flex;*/
    display: none;
    justify-content: center;
    align-items: center;
    color: snow;
    font-size: 12px;
    text-align: center;
}
ready>span {
    z-index: 100;
    margin-top: 5px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
cover {
    z-index: 50;
    position: absolute;
    left: 0;
    top:0;
    right: 0;
    bottom: 0;
    background-color: black;
    opacity: 0.5;
}
player.disconnect portrait ready,
player.ready portrait ready,
player.speek portrait ready,
player.dead portrait ready
{
    display: flex;
}
player.ready portrait ready span:before {
    content: '就绪';
}
player.speek portrait ready span:before {
    content: '发言中';
}
player.dead portrait ready span:before {
    content: '死亡';
}
player.disconnect portrait ready span:after {
    content: '断线';
}
name {
    font-size: 10px;
    max-width: 47px;
    overflow:hidden;
    text-overflow:ellipsis;
    display:-webkit-box;
    -webkit-box-orient:vertical;
    -webkit-line-clamp:2;
    text-align: center;
}
clue {
    min-width: 50px;
    max-width: 60px;
    height: 69px;
    overflow-y: auto;
    margin: 3px 0;
}
tag {
    /*margin: 0 2px;*/
    display: block;
    color: blueviolet;
    font-size: 10px;
    font-weight: bold;
}
tag:before {
    content: "-";
}
tag:after {
    content: ";";
}
concern {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    margin: 10px 20px 0 20px;
}
help {
    display: inline;
}
help:before {
    content: '小贴士：';
}
round {
    margin: 10px 0;
}
template {
    display: none;
}
sidecover {
    z-index: 2000;
    position: absolute;
    left:0;
    right: 0;
    top:0;
    bottom: 0;
    /*display: flex;*/
    flex-direction: row;
    justify-content: flex-end;
    align-items: stretch;
    display: none;
}
sidecover.show {
    display: flex;
}
sideslip.show {
    opacity: 1;
    width: 120px;
}
sideslip {
    position: absolute;
    right: 0;
    top:0;
    bottom:0;

    width:0;
    opacity: 1;
    transition: all 0.6s ease;
    background-color: #202828;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    flex-direction: column;
    overflow: hidden;
}
sideslip>hr {
    width: 100px;
}
mine {
    margin-top: 40px;
    margin-bottom: 10px;
}
myimg {
    display: block;
    width: 60px;
    height: 60px;

    background-position: center;
    background-size: contain;
}
mynuser {
    display: block;
    width: 100%;
    height: 20px;
    color: white;
    line-height: 20px;
    text-align: center;
    font-weight: bold;
}
mymenu {
    margin: 20px 0 80px 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
exit{
    display: block;
    width: 50px;
    height: 63px;


    background: url("img/exit.svg") no-repeat;
    background-size: contain;
}
reset {
    display: block;
    width: 50px;
    height: 63px;


    background: url("img/refresh.svg") no-repeat;
    background-size: contain;
}
room {
    height: 30px;
    display: block;
    line-height: 30px;
    color: snow;
    font-size: 14px;
}
/**/
sideslip.show + levitate {
    right: 60px;
    bottom: 40px;
}
levitate {
    position: absolute;
    right: 28px;
    bottom: 28px;
    transition: all 600ms;
}

levitate .bulb {
    width: 48px;
    height: 48px;

    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
}
sideslip.show + levitate .bulb {
    width: 64px;
    height: 64px;
}

levitate #s-bulb {
    stroke: #262832;
    fill: #262832;
    stroke-width: 0;
    transition: 300ms;
}

levitate #s-bulb {
    stroke: #262832;
    fill: #262832;
    transition: 1500ms;
}

sideslip.show + levitate #s-bulb {
    fill: #c4d8d9;
    stroke: #c4d8d9;
    stroke-width: 2;
    transition: 100ms;
}

levitate #www-filament {
    stroke-width: 0;
    stroke-width: 0;
    transition: 300ms;
}

levitate #www-filament {
    fill: #333542;
    stroke: #333542;
    transition: 1500ms;
}

sideslip.show + levitate #www-filament {
    stroke: #ffdf43;
    stroke-width: 3;
    fill: #ffdf43;
    transition: all 600ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
}


levitate .light {
    width: 48px;
    height: 48px;
    margin-top: -7px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

}
sideslip.show + levitate .light {
    width: 64px;
    height: 64px;
    margin-top: -10px;
}

levitate .light .glow {
    width: 0px;
    height: 0px;
    border-radius: 50%;
    opacity: 0;
    background: -webkit-radial-gradient(rgba(255,223,67,1), rgba(255,223,67,0) 70%);
    position: absolute;
    display: block;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: all 1000ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

sideslip.show + levitate .light .glow {
    width: 50px;
    height: 50px;
    opacity: 0.2;
    background: -webkit-radial-gradient(rgba(255,223,67,1), rgba(255,223,67,0) 70%);
    transition: all 800ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

levitate .light .flare {
    width: 0px;
    height: 0px;
    border-radius: 50%;
    opacity: 0;
    background: rgba(255,223,67,0);
    position: absolute;
    display: block;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: all 1000ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

sideslip.show + levitate .light .flare {
    width: 50px;
    height: 50px;
    opacity: 0.5;
    background: rgba(255,223,67,1);
    transition: all 600ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes act {
    100% {
        stroke-dashoffset: 0;
    }
}
pop {
    position: absolute;
    bottom: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    opacity: 0.9;
    z-index: 3000;
}
tips {
    text-align: center;
    font-size: 14px;
    line-height: 30px;
    color: #cccccc;
    background-color: black;
    border-radius: 8px;
    padding: 0 20px;
    max-height: 100%;
    overflow-y: auto;
}
tips>h3 {
    font-size: 14px;
    border-bottom: 1px #cccccc dashed;
}
tips>h4 {
    font-size: 14px;
    border-top: 1px #cccccc dashed;
    border-bottom: 1px #cccccc dashed;
}
tips>p {
    display: block;
}
svg[name=tips] {
    position: absolute;
    margin-top: 1px;
    margin-left: 1px;
    z-index: -2;
    width: 51px;
    height: 73px;
}
player svg[name=tips] {
    margin-left: -2px;
}
mic {
    display: block;
    background: url("img/mic.png") no-repeat;
    background-position: center;
    background-size: contain;
    width:40px;
    height:40px;
}
mic.quiet {
    background-image: url("img/mic_quiet.gif");
}
mic.noisy {
    background-image: url("img/mic_noisy.gif");
}

vote {
    display: block;
    border: 1px #ccc solid;
    border-radius: 6px;
    background-color: #efefef;
    width: 60px;
    height: 30px;
    text-align: center;
    line-height: 30px;
    color: tomato;
    margin-top: 4px;
}

poker[value=化身幽灵] {
    background-image: url('img/化身幽灵.png');
}
poker[value=狼人], poker[value=化身狼人] {
    background-image: url('img/狼人.png');
}
poker[value=爪牙], poker[value=化身爪牙] {
    background-image: url('img/爪牙.png');
}
poker[value=守夜人], poker[value=化身守夜人] {
    background-image: url('img/守夜人.png');
}
poker[value=预言家], poker[value=化身预言家] {
    background-image: url('img/预言家.png');
}
poker[value=强盗], poker[value=化身强盗] {
    background-image: url('img/强盗.png');
}
poker[value=捣蛋鬼], poker[value=化身捣蛋鬼] {
    background-image: url('img/捣蛋鬼.png');
}
poker[value=酒鬼], poker[value=化身酒鬼] {
    background-image: url('img/酒鬼.png');
}
poker[value=失眠者], poker[value=化身失眠者] {
    background-image: url('img/失眠者.png');
}
poker[value=猎人], poker[value=化身猎人] {
    background-image: url('img/猎人.png');
}
poker[value=皮匠], poker[value=化身皮匠] {
    background-image: url('img/皮匠.png');
}
poker[value=村民], poker[value=化身村民] {
    background-image: url('img/村民.png');
}
player poker[value^=化身]:before {
    font-size: 14px;
    color: white;
    content: '化身';
}
/**/
end {

}
</style>


</head>
<body>
<page>
    <game>
        <row-center style="margin: 0px 5px;">
            <discard>
                <column>
                    <poker></poker>
                </column>
                <column>
                    <poker></poker>
                </column>
                <column>
                    <poker></poker>
                </column>
            </discard>

        </row-center>
        <seat>

        </seat>

    </game>
    <pop>
        <tips>

        </tips>
        <mic style="display: none;"></mic>
        <vote style="display: none;">投票</vote>
    </pop>

</page>
<!--<sidecover>-->
    <!---->
<!--</sidecover>-->
<sideslip>
    <mine>
        <myimg></myimg>
        <mynuser></mynuser>
    </mine>
    <hr>
    <mymenu>
        <reset></reset>
        <exit></exit>
        <room></room>
    </mymenu>
</sideslip>
<levitate>
    <svg class="bulb" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="64px" height="64px" viewBox="0 0 128 128" enable-background="new 0 0 128 128" xml:space="preserve">
<g id="s-bulb">
	<g>
		<path fill-rule="evenodd" clip-rule="evenodd" d="M104.145,42.922c-0.258-9.541-3.436-19.458-10.576-27.913
			C88.695,9.245,82.706,5.05,75.47,2.746c-3.798-1.209-7.682-1.965-11.683-1.916c-3.553,0.043-7.022,0.693-10.406,1.747
			c-9.279,2.88-16.414,8.597-21.776,16.625C28.182,24.328,26.107,29.98,24.958,36c-0.742,3.904-1.014,7.844-0.657,11.804
			c0.858,9.513,4,18.144,10.17,25.542c2.009,2.413,4.117,4.748,5.545,7.566c1.062,2.094,1.989,4.256,2.942,6.4
			c1.076,2.427,2.774,4.205,5.371,4.859c1.925,0.485,3.702,1.281,5.499,2.063c2.902,1.265,5.809,2.526,8.709,3.795
			c2.195,0.955,4.388,1.918,6.581,2.884c2.589,1.138,5.17,2.287,7.762,3.413c1.31,0.57,2.841,0.235,3.577-0.708
			c1.095-1.397,0.673-3.48-1.087-4.271c-1.669-0.753-3.345-1.488-5.019-2.222c-2.038-0.891-4.08-1.776-6.12-2.666
			c-2.604-1.136-5.216-2.268-7.821-3.411c-2.003-0.878-4-1.771-6.005-2.644c-1.102-0.479-2.207-0.95-3.326-1.39
			c-0.417-0.161-0.891-0.179-1.308-0.344c-0.764-0.298-1.278-0.869-1.553-1.646c-1.768-4.971-4.392-9.464-7.759-13.508
			c-1.509-1.809-3.09-3.554-4.336-5.57c-3.335-5.383-5.46-11.171-6.052-17.516c-0.915-9.789,1.291-18.79,6.863-26.889
			c4.957-7.208,11.708-12.015,20.204-14.157c6.392-1.611,12.689-1.011,18.773,1.573c9.279,3.942,15.587,10.785,19.488,19.984
			c2.296,5.405,3.22,11.05,3.011,16.889c-0.317,8.925-3.272,16.896-8.946,23.792c-2.068,2.513-4.124,5.015-5.803,7.807
			c-1.402,2.332-2.552,4.787-3.472,7.349c-0.474,1.314-1.366,2.028-2.757,2.188c-0.928,0.106-1.761,0.435-2.275,1.309
			c-0.89,1.508-0.273,3.811,1.588,4.196c1.883,0.39,3.575-0.188,5.144-1.113c1.738-1.026,2.893-2.557,3.605-4.471
			c1.734-4.653,4.226-8.836,7.528-12.581c4.964-5.618,8.227-12.141,9.869-19.48C103.665,51.369,104.143,47.883,104.145,42.922z"></path>
		<path fill-rule="evenodd" clip-rule="evenodd" d="M77.257,116.188c0.884,0.346,1.702,0.202,2.46-0.188
			c0.947-0.494,1.366-1.401,1.348-2.405c-0.02-1.136-0.615-2.013-1.687-2.491c-1.944-0.869-3.899-1.721-5.848-2.575
			c-1.709-0.747-3.419-1.491-5.13-2.234c-2.676-1.171-5.354-2.338-8.028-3.509c-2.347-1.031-4.684-2.087-7.038-3.102
			c-0.792-0.343-1.614-0.626-2.435-0.891c-0.897-0.287-2.432,0.154-2.961,1.172c-0.715,1.37-0.362,3.355,1.264,4.016
			c2.498,1.021,4.943,2.155,7.415,3.23c2.935,1.281,5.875,2.56,8.81,3.84c2.003,0.878,3.997,1.774,6.002,2.646
			c0.324,0.139,0.452,0.309,0.4,0.68c-0.46,3.388-2.759,5.917-6.027,6.749c-3.471,0.886-7.294-1.126-8.787-4.443
			c-0.481-1.063-0.592-2.182-0.792-3.296c-0.254-1.407-1.227-2.001-2.529-2.222c-0.908-0.151-2.159,0.46-2.663,1.422
			c-0.438,0.83-0.415,1.74-0.272,2.663c0.696,4.489,2.935,7.963,6.953,10.109c3.115,1.666,6.446,2.109,9.915,1.108
			c5.003-1.449,8.154-4.682,9.476-9.707C77.146,116.592,77.19,116.428,77.257,116.188z"></path>
	</g>
</g>
<g id="www-filament">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M82.985,29.716c0.897-0.62,1.849-0.822,2.957-0.547
		c1.471,0.363,2.109,1.95,1.953,3.176c-0.134,1.05-0.666,1.823-1.564,2.383c-0.25,0.155-0.498,0.438-0.585,0.712
		c-0.553,1.734-1.059,3.483-1.584,5.222c-1.027,3.403-2.059,6.806-3.089,10.205c-0.604,1.997-1.211,3.989-1.814,5.985
		c-1.007,3.331-2.012,6.67-3.021,10.001c-0.741,2.449-1.484,4.895-2.227,7.345c-1.016,3.353-2.025,6.708-3.051,10.062
		c-0.217,0.716-0.948,1.105-1.604,0.909c-0.719-0.215-1.057-0.821-0.822-1.608c1.04-3.506,2.104-7.005,3.151-10.508
		c0.364-1.205,0.724-2.423,1.126-3.771c-0.78,0.522-1.44,0.955-2.093,1.4c-0.971,0.659-2.496,0.685-3.463-0.059
		c-1.034-0.789-2.072-1.576-3.105-2.36c-1.011,0.771-2.009,1.495-2.968,2.274c-1.044,0.847-2.709,0.815-3.751,0.048
		c-0.78-0.574-1.604-1.091-2.516-1.7c0.321,1.07,0.595,2.012,0.879,2.952c1.155,3.807,2.311,7.614,3.46,11.425
		c0.084,0.283,0.161,0.6,0.131,0.887c-0.055,0.601-0.562,1.034-1.146,1.081c-0.543,0.045-1.157-0.374-1.344-0.949
		c-0.223-0.688-0.418-1.38-0.628-2.069c-1.357-4.498-2.712-8.995-4.074-13.494c-2.142-7.073-4.292-14.143-6.432-21.218
		c-0.945-3.118-1.818-6.26-2.834-9.356c-0.494-1.505-0.604-3.163-1.934-4.375c-0.766-0.701-0.747-1.802-0.425-2.832
		c0.275-0.885,0.818-1.444,1.703-1.732c1.167-0.381,2.189-0.102,3.155,0.579c0.963,0.675,1.942,1.331,2.909,2.001
		c1.774,1.23,3.548,2.467,5.34,3.713c0.854-0.667,1.69-1.326,2.526-1.98c2.092-1.639,4.174-3.288,6.276-4.914
		c0.789-0.609,2.453-0.664,3.224-0.089c1.265,0.942,2.491,1.93,3.729,2.9c1.731,1.358,3.462,2.715,5.197,4.082
		C77.429,33.558,80.204,31.632,82.985,29.716z M76.578,46.931c0.969-0.69,1.972-1.112,3.223-0.72
		c0.871-2.883,1.733-5.738,2.598-8.592c-0.037-0.027-0.071-0.052-0.107-0.082c-0.538,0.37-1.078,0.729-1.615,1.101
		c-1.452,1.002-2.898,2.017-4.356,3.011c-1.11,0.759-2.634,0.747-3.716-0.083c-1.969-1.515-3.91-3.071-5.864-4.604
		c-0.852-0.669-1.703-1.334-2.583-2.02c-1.043,0.813-2.09,1.621-3.129,2.439c-1.82,1.425-3.612,2.896-5.469,4.276
		c-0.99,0.738-2.432,0.763-3.523,0.02c-1.913-1.306-3.813-2.632-5.719-3.947c-0.295-0.206-0.593-0.406-1.044-0.714
		c0.96,3.179,1.871,6.201,2.794,9.26c0.205-0.032,0.395-0.032,0.566-0.086c1.027-0.336,1.94-0.049,2.781,0.529
		c1.647,1.127,3.29,2.26,4.912,3.415c0.35,0.255,0.56,0.217,0.875-0.037c1.671-1.344,3.368-2.654,5.042-3.993
		c1.141-0.916,2.937-0.785,4.069,0.181c1.643,1.404,3.388,2.689,5.091,4.024c0.042,0.033,0.102,0.047,0.187,0.083
		C73.242,49.245,74.926,48.105,76.578,46.931z M58.842,56.22c-1.109,0.887-2.681,0.887-3.8,0.103
		c-1.462-1.027-2.936-2.034-4.404-3.048c-0.141-0.099-0.283-0.189-0.567-0.375c0.981,3.251,1.921,6.36,2.869,9.502
		c0.791-0.181,1.538-0.45,2.304-0.103c0.256,0.118,0.54,0.186,0.773,0.334c0.95,0.628,1.891,1.271,2.826,1.924
		c0.253,0.175,0.43,0.189,0.693-0.025c0.866-0.709,1.776-1.363,2.642-2.074c1.126-0.928,2.846-0.918,3.977,0.019
		c0.864,0.716,1.772,1.371,2.641,2.077c0.246,0.201,0.415,0.177,0.647,0.017c0.734-0.512,1.478-1,2.207-1.517
		c0.595-0.423,1.191-0.828,1.945-0.873c0.422-0.024,0.845-0.004,1.382-0.004c0.854-2.827,1.741-5.768,2.629-8.712
		c-0.035-0.022-0.074-0.045-0.11-0.066c-1.198,0.829-2.402,1.652-3.601,2.488c-0.624,0.432-1.232,0.851-2.021,0.982
		c-0.781,0.128-1.497-0.009-2.094-0.452c-1.885-1.412-3.73-2.875-5.633-4.353C62.366,53.453,60.59,54.814,58.842,56.22z
		 M49.028,49.956c2.344,1.648,4.709,3.274,7.077,4.887c0.628,0.428,1.043,0.387,1.659-0.094c1.708-1.326,3.414-2.657,5.121-3.987
		c0.839-0.653,1.699-0.653,2.537,0c1.704,1.331,3.409,2.661,5.121,3.987c0.615,0.481,1.028,0.522,1.658,0.094
		c2.369-1.613,4.725-3.247,7.086-4.874c0.473-0.325,0.651-0.772,0.525-1.338c-0.091-0.433-0.369-0.79-0.793-0.757
		c-0.429,0.026-0.88,0.21-1.245,0.443c-0.899,0.564-1.756,1.198-2.628,1.804c-0.794,0.555-1.589,1.109-2.388,1.659
		c-0.772,0.534-1.678,0.551-2.419-0.02c-1.791-1.381-3.56-2.781-5.33-4.185c-0.543-0.429-1.167-0.429-1.71,0
		c-1.771,1.404-3.541,2.804-5.328,4.181c-0.742,0.575-1.648,0.562-2.425,0.024c-1.653-1.146-3.304-2.295-4.958-3.439
		c-0.204-0.143-0.413-0.278-0.636-0.376c-0.814-0.355-1.507,0.114-1.61,1.089C48.567,49.361,48.733,49.747,49.028,49.956z
		 M69.706,69.17c1.593-1.068,3.174-2.148,4.762-3.23c0.433-0.293,0.533-0.718,0.451-1.198c-0.075-0.439-0.348-0.77-0.781-0.783
		c-0.331-0.012-0.712,0.114-0.997,0.293c-0.946,0.599-1.859,1.252-2.787,1.878c-0.884,0.597-1.77,0.554-2.615-0.106
		c-0.926-0.729-1.854-1.457-2.781-2.18c-0.52-0.405-1.094-0.403-1.619,0.008c-0.927,0.722-1.851,1.449-2.779,2.176
		c-0.841,0.661-1.728,0.694-2.615,0.096c-0.913-0.617-1.818-1.245-2.732-1.857c-0.725-0.484-1.3-0.452-1.658,0.066
		c-0.386,0.562-0.22,1.265,0.432,1.712c1.502,1.037,3.008,2.06,4.521,3.081c0.596,0.396,1.035,0.381,1.624-0.062
		c0.955-0.717,1.889-1.463,2.849-2.173c0.768-0.572,1.585-0.569,2.355,0.003c0.96,0.716,1.895,1.462,2.854,2.174
		c0.232,0.173,0.526,0.271,0.787,0.399C69.262,69.355,69.511,69.304,69.706,69.17z"></path>
</g>
</svg>
    <div class="light"><span class="glow"></span><span class="flare"></span></div>

</levitate>

<template>
    <player seat="13">
        <column-center>
            <portrait>
                <no></no>
                <ready>
                    <cover></cover>
                    <span class="state"></span>
                </ready>
            </portrait>
            <name></name>

        </column-center>
        <poker></poker>
        <clue>

        </clue>

    </player>
</template>
<script src="js/jquery-1.12.1-ui.min.js"></script>
<script src="js/jquery.ui.touch-punch.min.js"></script>
<script src="js/game.js"></script>
<script>
    var no = window.location.hash;
    if (!no || no=='') {
        alert('房间号无效！');
        window.location = 'index.html';
    } else {
        no = no.replace('#', '');
        $('room').html('No.'+no);
    }
    var user = localStorage.getItem('user');
    var img = localStorage.getItem('img');
    if (!user) {
        alert('请重新登录！');
        window.location = 'index.html';
    } else {
        $('mynuser').html(user);
        $('myimg').css('background-image', 'url('+img+')');
    }
    function sitdown(seat, user, img) {
        var self = $(seat);
        self.find('name').html(user);
        var portrait = self.find('portrait');
        portrait.css('background-image', 'url('+img+')');
        if (user == window.user) {
            portrait.css('border', '1px #ff6483 solid');
        }
        self.attr('value', user);
    }
    function leaveSeat(seat) {
        var self = $(seat);
        self.find('name').html('');
        self.find('portrait').removeAttr('style');
        self.removeAttr('value');
    }
    function changeSeat(seat, user, img) {
        $('page player portrait').parents('player').each(function () {
           if (this == seat) {
               sitdown(this, user, img);
           } else if (this.getAttribute("value") == user) {
               leaveSeat(this);
           }
        });
    }
    function readyStatus(seat) {
        var self = $(seat);
        self.toggleClass('ready', true);
    }
    function notReadyStatus(seat) {
        var self = $(seat);
        self.toggleClass('ready', false);
    }
    function disconnectStatus(seat) {
        var self = $(seat);
        self.toggleClass('disconnect', true);
    }
    function connectStatus(seat) {
        var self = $(seat);
        self.toggleClass('disconnect', false);
    }
    function template_node(selector) {
        var jq = $('template');
        var template = jq.prop('content');
        if (template) {
            return $(template).find(selector).get(0);
        } else {
            return jq.find(selector).get(0);
        }
    }
    function buildSeat(count) {
        var node = template_node('player');
        var seatCount = count;
        if (count == 13) {
            var newNode = document.importNode(node, true);
            $(newNode).attr('seat', 13);
            $('discard').after(newNode);//.parent().append(newNode);
            seatCount = 12;
        }
        var jq_seat = $('seat');
        var i = 1;
        for (i=1; i<=seatCount; i++) {
            var newNode = document.importNode(node, true);
            $(newNode).attr('seat', i);
            jq_seat.append(newNode);
        }
        //
        $('discard poker').each(function (index) {
            this.innerHTML = ''+(count+1+index);
        })
    }
    function readySitdown() {
        var self = $(this).parents('player');
        var seat = self.attr('seat');
        seat = parseInt(seat);

        if (Guide.current == 'Ready') {
            // 就位阶段, 可以换位置
            if (self.attr('value') == null) {
                if ($('player.ready[value="'+user+'"]').length>0) {
                    return;
                }
                websocket.http('sitdown', {
                    seat: seat,
                }, function () {
                    changeSeat(self.get(0), user, img);
                });
            } else if (self.attr('value') == user) {
                var ready = !self.hasClass('ready');
                websocket.http('ready', {
                    ready: ready
                }, function () {
                    self.toggleClass('ready');
                })
            }
        }

    }
</script>
<script>
    function Doppel() {
        var playerPokers = $('player:not([value="'+user+'"]) poker');
        playerPokers.tipsPoker('blue').click(function () {
            var seat = $(this).parents('player').attr('seat');
            seat = parseInt(seat);
            websocket.http('targets', {
                targets:[seat]
            }, function () {
                playerPokers.cancelTips();
                playerPokers.unbind();
                $('tips').html('等待其他玩家行动...');
            });
        });
    }
    function Wolves(data) {
        var publicPokers = $('discard poker');
        var targets = [];
        publicPokers.tipsPoker('#202828').click(function () {
            var self = $(this);
            var seat = self.html();
            seat = parseInt(seat);
            var poker = data.deck[seat];
            targets.push(seat);
            if (poker == '狼人' || poker == '化身狼人') {
                self.attr('value', poker);
                self.cancelTips();
                self.unbind();
                return;
            }
            websocket.http('targets', {
                targets:targets
            }, function () {
                publicPokers.cancelTips();
                publicPokers.unbind();
                $('tips').html('等待其他玩家行动...');
            });
        });
    }
    function Seer() {
        var playerPokers = $('player:not([value="'+user+'"]) poker');
        var targets = [];
        var publicPokers = $('discard poker');
        publicPokers.tipsPoker('#202828').click(function () {
            var self = $(this);
            var seat = self.html();
            seat = parseInt(seat);

            targets.push(seat);
            if (targets.length == 1) {
                playerPokers.cancelTips();
            }else if (targets.length == 2) {
                websocket.http('targets', {
                    targets:targets
                }, function () {
                    publicPokers.cancelTips();
                    playerPokers.unbind();
                    $('tips').html('等待其他玩家行动...');
                });
            }
            self.cancelTips();
        });
        playerPokers.tipsPoker('blue').click(function () {
            var seat = $(this).parents('player').attr('seat');
            seat = parseInt(seat);
            websocket.http('targets', {
                targets:[seat]
            }, function () {
                publicPokers.cancelTips();
                publicPokers.unbind();
                playerPokers.cancelTips();
                playerPokers.unbind();
                $('tips').html('等待其他玩家行动...');
            });
        });
    }

    function Robber() {
        var playerPokers = $('player:not([value="'+user+'"]) poker');
        playerPokers.tipsPoker('blue').click(function () {
            var seat = $(this).parents('player').attr('seat');
            seat = parseInt(seat);
            websocket.http('targets', {
                targets:[seat]
            }, function () {
                playerPokers.cancelTips();
                playerPokers.unbind();
                $('tips').html('等待其他玩家行动...');
            });
        });
    }
    
    function TroubleMarker() {
        var targets = [];
        var playerPokers = $('player:not([value="'+user+'"]) poker');
        playerPokers.tipsPoker('blue')
        /*.castSpellBy('player poker', function (from, to) {
            var fromSeat = $(from).parents('player').attr('seat');
            fromSeat = parseInt(fromSeat);

            var toSeat = $(to).parents('player').attr('seat');
            toSeat = parseInt(toSeat);

            websocket.http('targets', {
                targets:[fromSeat, toSeat]
            }, function () {
                playerPokers.cancelTips();
                cancelSpell();
                $('tips').html('等待其他玩家行动...');
            });
        })*/
        .click(function () {
            var jq = $(this);
            var seat = jq.parents('player').attr('seat');
            seat = parseInt(seat);
            targets.push(seat);
            if (targets.length == 1) {
                jq.cancelTips();
                $('tips').html('捣蛋鬼:再选择一张身份牌交换!');
            }else if (targets.length == 2) {
                websocket.http('targets', {
                    targets:targets
                }, function () {
                    playerPokers.cancelTips();
                    cancelSpell();
                    $('tips').html('等待其他玩家行动...');
                });
            }
        });
    }

    function Drunk() {
        var publicPokers = $('discard poker');
        publicPokers.tipsPoker('#202828').click(function () {
            var self = $(this);
            var seat = self.html();
            seat = parseInt(seat);
            websocket.http('targets', {
                targets:[seat]
            }, function () {
                $('player[value='+user+'] poker').removeAttr('value');
                publicPokers.cancelTips();
                publicPokers.unbind();
                $('tips').html('等待其他玩家行动...');
            });
        });
    }

    function Vote() {
        $('tips').html('发起投票！--投给自己为弃权票');
        var playerPokers = $('player poker').tipsPoker('blue').click(function () {
            var jq = $(this);
            var seat = 0;
            var jqplayer = jq.parents('player');
            if (jqplayer.attr('value') != user) {
                seat = jqplayer.attr('seat');
                seat = parseInt(seat);
            }
            websocket.http('vote', {
                vote:seat
            }, function () {
                playerPokers.cancelTips();
                playerPokers.unbind();
                $('tips').html('等待其他玩家投票...');
            });
        });
    }

    var Guide = {
        current: 'Ready',
        existUser: function () {
            alert('账号被占用,请重新登录！');
            window.location = 'index.html';
        },
        notExistGame: function () {
            alert('该房间号未创建！');
            window.location = 'index.html';
        },
        Ready: function () {
            $('page player portrait').click(readySitdown);
        },
        Doppel: function () {
            $('tips').html('化身幽灵:点击你要复制的身份牌!');
            Doppel();
        },
        Wolves : function (data) {
            $('tips').html('孤狼:点击你要查看的公共牌!');
            Wolves(data);
        },
        Seer: function () {
            $('tips').html('预言家:点击你要查看的公共牌/身份牌!');
            Seer();
        },
        AsSeer: function () {
            $('tips').html('化身预言家:点击你要查看的公共牌/身份牌!');
            Seer();
        },
        Robber: function () {
            $('tips').html('强盗:点击你抢走的身份牌!');
            Robber();
        },
        AsRobber: function () {
            $('tips').html('化身强盗:点击你抢走的身份牌!');
            Robber();
        },
        TroubleMarker: function () {
            $('tips').html('捣蛋鬼:点选你要交换的两张身份牌!');
            TroubleMarker();
        },
        AsTroubleMarker: function () {
            $('tips').html('化身捣蛋鬼:点选你要交换的两张身份牌!');
            TroubleMarker();
        },
        Drunk: function () {
            $('tips').html('酒鬼:点击你要交换的公共牌!');
            Drunk();
        },
        AsDrunk: function () {
            $('tips').html('化身酒鬼:点击你要交换的公共牌!');
            Drunk();
        },
        Speek: function (data) {
            $('tips').html('当前'+data.speekCurrentIndex+'号发言，第'+data.speekRound+'轮，每轮从'+data.speekStartIndex+'号开始!');
            $('player.speek').removeClass('speek');
            //data.speekCurrentIndex;
            var jq = $('player[seat='+data.speekCurrentIndex+']');
            jq.addClass('speek');
            if (jq.attr('value')==user) {
                $('mic').fadeIn();
            }
        },
        Vote: function () {
            $('player.speek').removeClass('speek');
            $('tips').html('点击按钮可以开始投票!');
            $('vote').fadeIn();
        },
        ReturnVote : function () {
            $('tips').html('等待其他玩家投票...');
        },
        Hunter : function (data) {
            /// 死亡情况
            var deadth = data.deadth;
            string += '<h4>死亡:</h4>';
            if (deadth.length == 0) {
                string += '无人死亡';
            } else {
                for(var i=0;i<deadth.length;i++){
                    var d = deadth[i];
                    string += d + '号';
                    $('player[seat='+d+']').addClass('dead');
                }
            }
            /// 投票
            var string = '<h4>投票情况:</h4>';
            var votes = data.votes;
            for (var seat in votes) {
                var vote = votes[seat];
                if (vote) {
                    string += seat+'号 =>'+vote+'号<br>';
                } else {
                    string += seat+'号弃权票<br>';
                }
            }
            ///
            $('tips').html(string);

            var playerPokers = $('player:not([value="'+user+'"]) poker');
            playerPokers.tipsPoker('blue').click(function () {
                var seat = $(this).parents('player').attr('seat');
                seat = parseInt(seat);
                websocket.http('hunter', {
                    target:seat
                }, function () {
                    playerPokers.cancelTips();
                    playerPokers.unbind();
                });
            });
        },
        Finally : function (data) {
            /// 翻开所有牌
            var deck = data.deck;
            var desktop = data.desktop;
            for (var seat in deck) {
                var poker = deck[seat];

                // 翻牌
                $('player[seat='+seat+'] poker').attr('value', poker);
                $('discard poker').each(function () {
                    var jq = $(this);
                    if (jq.html() == ''+seat) {
                        jq.attr('value', poker);
                    }
                });
                // 行动步骤
                var info = desktop[seat];
                if (info) {
                    var movements = info['movements'];
                    var movement = null;
                    var clue = $('player[value="'+info.user+'"] clue').empty();
                    for (var i=0;i<movements.length;i++) {
                        movement = movements[i];
                        var spell = movement.spell;
                        clue.append('<tag>'+spell.name+'</tag>');
                    }
                }
            }
            ///
            var report = data.report;
            var string = '<h3>'+report.description+':</h3>';
            var all = report.all;
            var town = report.town;
            var wolves = report.wolves;
            var cobbler = report.cobbler;
            /// 胜败
            string += '<p>'+camp(all) + '</p>';
            string += '<p>'+camp(town) + '</p>';
            string += '<p>'+camp(wolves) + '</p>';
            string += '<p>'+camp(cobbler)+'</p>';
            /// 死亡情况
            var deadth = data.deadth;
            string += '<h4>死亡:</h4>';
            if (deadth.length == 0) {
                string += '无人死亡';
            } else {
                for(var i=0;i<deadth.length;i++){
                    var d = deadth[i];
                    string += d + '号';
                    $('player[seat='+d+']').addClass('dead');
                }
            }

            /// 猎人权力
            var hunterKill = data.hunterKill;
            if (Object.keys(hunterKill).length > 0) {
                string += '<h4>猎人权力:</h4>';
                for (var seat in hunterKill) {
                    var kill = hunterKill[seat];
                    string += seat+'号 kill '+kill+'号<br>';
                }
            }

            /// 投票
            string += '<h4>投票情况:</h4>';
            var votes = data.votes;
            for (var seat in votes) {
                var vote = votes[seat];
                if (vote) {
                    string += seat+'号 =>'+vote+'号<br>';
                } else {
                    string += seat+'号弃权票<br>';
                }
            }
            ///
            $('tips').html(string);
        }
    };
    function camp(c) {
        if (!c) return '';
        var string = c.name+':'+(c.win?'获胜':'落败')+'<br>';
        for (var i=0;i<c.members.length;i++) {
            var member = c.members[i];
            if (i!=0) {
                string += ',';
            }
            string += member.seat+'号'+member.user;
        }
        return string;
    }
</script>
<script>
    var websocket = new WebSocket('ws://'+window.location.basepath+'/game/'+no);
    /*切换重连*/
    document.addEventListener('webkitvisibilitychange',function(){
        if (document.webkitVisibilityState == 'visible') {
            if (websocket.readyState >= 3) {
                window.location.reload(true);
            }
        }
    });

    websocket.admit("syncGame", loadGame);
    websocket.admit("gameStart", loadGame);
    websocket.admit("Doppel", Guide.Doppel);
    websocket.admit("Wolves", Guide.Wolves);
    websocket.admit("Seer", Guide.Seer);
    websocket.admit("AsSeer", Guide.AsSeer);
    websocket.admit("Robber", Guide.Robber);
    websocket.admit("AsRobber", Guide.AsRobber);
    websocket.admit("TroubleMarker", Guide.TroubleMarker);
    websocket.admit("AsTroubleMarker", Guide.AsTroubleMarker);
    websocket.admit("Drunk", Guide.Drunk);
    websocket.admit("AsDrunk", Guide.AsDrunk);
    websocket.admit("Speek", Guide.Speek);
    websocket.admit("Vote", Guide.Vote);
    websocket.admit("ReturnVote", Guide.ReturnVote);
    websocket.admit("Hunter", Guide.Hunter);
    websocket.admit("Finally", Guide.Finally);

    websocket.onConnect(function () {
        websocket.http('login', {
            user: user,
            img: img
        }, function (data) {
            if (data['playerCount']) {
                var playerCount = data.playerCount;
                buildSeat(playerCount);

                loadGame(data);
            }

            var stage = data.stage;
            if (stage) {
                if (Guide[stage]) {
                    Guide[stage](data);
                }
            }
        });
    });

    websocket.onDisconnect(function () {
        connectFail();
    });

    function loadGame(game) {
        var stage = game.stage;
        var desktop = game.desktop;
        for (var seat in desktop) {
            var info = desktop[seat];
            if (!info['user']) {
                continue;
            }
            var domSeat = $('player[seat="'+seat+'"]').get(0);
            changeSeat(domSeat, info.user, info.img);
            if (stage == 'Ready') {
                if (info.ready) {
                    readyStatus(domSeat);
                } else {
                    notReadyStatus(domSeat);
                }
            } else {
                if (stage) {
                    Guide.current = stage;
                }
                // 删除换座位等事件
                $('page player portrait').unbind();
                notReadyStatus(domSeat);
            }
            if (info.disconnect) {
                disconnectStatus(domSeat);
            } else {
                connectStatus(domSeat);
            }
            // 自我视角
            if (info['user'] == user) {
                var movements = info['movements'];
                var movement = null;
                var clue = $('player[value="'+user+'"] clue').empty();
                for (var i=0;i<movements.length;i++) {
                    movement = movements[i];
                    var spell = movement.spell;
                    clue.append('<tag>'+spell.name+'</tag>');
                }

                if (movement && movement['viewport']) {
                    var viewport = movement['viewport'];
                    for (var seat in viewport) {
                        var poker = viewport[seat];
                        if (poker == '化身幽灵') {

                        } else if (poker.indexOf('化身') == 0) {
                            var afterpoker = poker.substr('化身'.length);// 化身以后
                            var beforepoker = '化身幽灵';// 化身之前
                            if (info.poker.indexOf('化身') == 0) {
                                poker = viewport[seat];
                            } else if (info.poker == '狼人' ||
                                info.poker == '守夜人' ||
                                info.poker == '爪牙'
                                ) {// 查看同伴,看到化身之后
                                poker = afterpoker;
                            } else {
                                poker = beforepoker;
                            }
                        }
                        $('player[seat='+seat+'] poker').attr('value', poker);
                        $('discard poker').each(function () {
                            var jq = $(this);
                            if (jq.html() == ''+seat) {
                                jq.attr('value', poker);
                            }
                        });
                    }
                }

            }
        }
    }
    $('tips').draggable({
        scroll:false
    });
    $('exit').click(function (event) {
        websocket.http('logout', null, function () {
            window.location = 'index.html#login';
        });
        event.stopPropagation();
    });
    $('reset').click(function (event) {
        // $('tips').css({
        //     left: '',
        //     top: ''
        // });
        window.location.reload(true);
        event.stopPropagation();
    });
    function openMenu() {
        $('sideslip').toggleClass('show', true);
        $(document.body).click(closeMenu);
    }
    //$(document.body).bind('swipeleftdown', openMenu);
    function closeMenu(event) {
        $('sideslip').toggleClass('show', false);
        $(document.body).unbind('click');
    }
    //$(document.body).bind('swiperightdown', closeMenu);
    $('levitate').click(function () {
        var jq = $('sideslip');
        if (jq.hasClass('show')) {
            closeMenu();
        } else {
            openMenu();
        }
        return false;
    });
    $('mic').click(function () {
        var self = $(this);
        if (self.hasClass('quiet') || self.hasClass('noisy')) {
            self.removeClass('quiet noisy');
            // 结束发言
            websocket.http('speek', {
                speek: '按不动'
            }, function () {
                //$('tips').html('等待其他玩家发言...');
                self.fadeOut();
            });
        } else {
            self.addClass('quiet');
            // 开始发言
        }

    });
    $('vote').click(function () {
        $('vote').fadeOut();
        Vote();
    });

</script>
</body>
</html>